<div class="amigos-container">
  <h2>Gestión de Amigos</h2>

  <div class="grid">
    <!-- COLUMNA DE AMIGOS -->
    <div class="col">
      <h3>AMIGOS ({{ amigos.length }})</h3>
      <div *ngFor="let amigo of amigos" class="card amigo">
        <img [src]="amigo.UserProfilePhoto || perfil_default" class="avatar" alt="Perfil" />
        <div class="info">
          <strong>{{ amigo.UserNickname }}</strong>
          
          <!-- Lógica de estado de conexión -->
          <div *ngIf="amigo.IsOnline; else offlineStatus" class="estado conectado">
            <span class="punto-verde"></span> Conectado
          </div>
          <ng-template #offlineStatus>
            <div class="estado desconectado">
              <span *ngIf="amigo.LastConnection; else neverConnected">
                Última conexión: {{ amigo.LastConnection | date:'short' }}
              </span>
              <ng-template #neverConnected>Desconectado</ng-template>
            </div>
          </ng-template>

        </div>
      </div>
      <div *ngIf="amigos.length === 0" class="card-placeholder">
        <p>Aún no tienes amigos. ¡Busca y añade algunos!</p>
      </div>
    </div>

    <!-- COLUMNA DE SOLICITUDES -->
    <div class="col">
      <h3>SOLICITUDES PENDIENTES ({{ solicitudesPendientes.length }})</h3>
      <div *ngFor="let solicitud of solicitudesPendientes" class="card solicitud">
        <img [src]="solicitud.userprofilephoto || perfil_default" class="avatar" alt="Perfil" />
        <div class="info">
          <strong>{{ solicitud.userNickname }}</strong>
          <span>Quiere ser tu amigo</span>
        </div>
        <div class="acciones">
          <button (click)="aceptarSolicitud(solicitud)" class="btn aceptar" title="Aceptar">✔</button>
          <button (click)="rechazarSolicitud(solicitud)" class="btn rechazar" title="Rechazar">✖</button>
        </div>
      </div>
      <div *ngIf="solicitudesPendientes.length === 0" class="card-placeholder">
        <p>No tienes solicitudes pendientes.</p>
      </div>
    </div>
  </div>
</div>

<hr class="divider">

<!-- SECCIÓN PARA BUSCAR Y AÑADIR USUARIOS -->
<div class="usuarios-section">
  <h3>Buscar Usuarios para Añadir</h3>
  <input type="text" [(ngModel)]="terminoBusqueda" (input)="buscarUsuarios()" placeholder="Buscar por apodo..." class="busqueda" />

  <div class="usuario-card" *ngFor="let usuario of usuariosFiltrados">
    <img [src]="usuario.UserProfilePhoto || perfil_default" class="avatar" alt="Perfil" />
    <div class="info">
      <strong>{{ usuario.UserNickname }}</strong>
      <span class="estado" [ngClass]="{'conectado': usuario.IsOnline, 'desconectado': !usuario.IsOnline}">
        {{ usuario.IsOnline ? 'Conectado' : 'Desconectado' }}
      </span>
    </div>
        <button 
      *ngIf="usuario.UserId !== usuarioId && !esAmigo(usuario.UserId!)"
      (click)="enviarSolicitud(usuario.UserId)" 
      class="btn enviar">
      Enviar Solicitud
    </button>
  </div>
</div>